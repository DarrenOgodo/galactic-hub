<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galactic Hub - Satellite Tracker</title>
    <!-- <link rel="stylesheet" type="text/css" href="../gallery/gallery.css"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <style>
        /* Add your custom styles here */
        body {
            font-family: 'Lato', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }

        .header {
            background-color: #333;
            color: white;
            padding: 20px 0;
            text-align: center;
        }

        .header h1 {
            margin: 0;
            font-size: 2rem;
        }

        .satellite-select {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
        }

        .satellite-select select {
            padding: 8px;
            font-size: 1rem;
        }

        .map-container {
            width: 100%;
            height: 500px;
            margin-top: 30px;
        }

        .footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 10px;
            position: fixed;
            width: 100%;
            bottom: 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Satellite Tracker</h1>
    </div>

    <div class="satellite-select">
        <label for="satelliteSelect">Select Satellites to Track:</label>
        <select id="satelliteSelect" multiple>
            <option value="25544">ISS</option>
            <option value="33591">Hubble</option>
            <option value="36751">Other Satellite</option>
        </select>
    </div>

    <div class="map-container" id="map"></div>

    <div class="footer">
        <p>&copy; 2025 Galactic Hub. All rights reserved.</p>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        // Initialize the map
        const map = L.map('map').setView([0, 0], 2); // Set the default view

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        const apiKey = "8CJTFR-Y8KBU8-QLTW4U-5E6E"; // Replace with your N2YO API Key
        const satelliteIds = [25544, 33591]; // Array of satellite IDs to display
        let satelliteMarkers = []; // Array to store markers for all satellites
        let userMarker = null; // Marker for the user's location

        // Fetch satellite data by ID
        async function fetchSatelliteData(id) {
            try {
                // const response = await fetch(`https://corsproxy.io/https://api.n2yo.com/rest/v1/satellite/positions/${id}/0/0/0/1/&apiKey=${apiKey}`);
                const data = await response.json();
                const position = data.positions[0];
                return {
                    latitude: position.satlatitude,
                    longitude: position.satlongitude,
                    altitude: position.sataltitude,
                    name: data.info.satname,
                    satelliteId: id
                };
            } catch (error) {
                console.error("Error fetching satellite data:", error);
                return null;
            }
        }

        // Generate popup content based on satellite details
        function getPopupContent(satellite) {
            return `
                <b>${satellite.name}</b><br>
                Satellite ID: ${satellite.satelliteId}<br>
                Latitude: ${satellite.latitude.toFixed(2)}<br>
                Longitude: ${satellite.longitude.toFixed(2)}<br>
                Altitude: ${satellite.altitude.toFixed(2)} km<br>
            `;
        }

        // Update satellite positions and popups on the map
        async function updateSatellites() {
            for (const id of satelliteIds) {
                const satelliteData = await fetchSatelliteData(id);

                if (satelliteData) {
                    const { latitude, longitude, satelliteId } = satelliteData;

                    let marker = satelliteMarkers.find(marker => marker.satelliteId === satelliteId);

                    if (!marker) {
                        marker = L.marker([latitude, longitude]).addTo(map);
                        marker.satelliteId = satelliteId;
                        marker.bindPopup(getPopupContent(satelliteData));
                        satelliteMarkers.push(marker);
                    } else {
                        marker.setLatLng([latitude, longitude]);
                        marker.getPopup().setContent(getPopupContent(satelliteData));
                    }
                }
            }
        }

        // Track the user's location using Geolocation API
        function trackUserLocation() {
            if (!navigator.geolocation) {
                console.error("Geolocation is not supported by your browser.");
                return;
            }

            navigator.geolocation.watchPosition(
                (position) => {
                    const { latitude, longitude } = position.coords;

                    if (!userMarker) {
                        
                        // Add a red marker for the user's location
                        userMarker = L.marker([latitude, longitude], {
                            icon: L.icon({
                                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
                                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                                iconSize: [25, 41], // Size of the icon
                                iconAnchor: [12, 41], // Anchor the icon to its base
                                popupAnchor: [1, -34], // Popup position
                                shadowSize: [41, 41]  // Shadow size
                            }),
                        }).addTo(map);

                        userMarker.bindPopup("<b>You are here!</b>");
                    } else {
                        // Update the marker's position
                        userMarker.setLatLng([latitude, longitude]);
                    }
                },
                (error) => {
                    console.error("Error getting user location:", error);
                },
                { enableHighAccuracy: true }
            );
        }
        
        // Initial satellite update
        updateSatellites();

        // Call updateSatellites every 5 seconds to keep the positions updated
        setInterval(updateSatellites, 5000);

        // Start tracking the user's location
        trackUserLocation();

    </script>
    
</body>
</html>
